# roles/kafka/handlers/main.yml
---
- name: Recreate Container
  shell: |
    if docker compose version >/dev/null 2>&1; then
      docker compose -f docker-compose.yml up -d --force-recreate kafka
    elif docker-compose --version >/dev/null 2>&1; then
      docker-compose -f docker-compose.yml up -d --force-recreate kafka
    else
      echo "NO_COMPOSE"
      exit 1
    fi
  args:
    chdir: "{{ compose_workdir }}"
  register: _handler
  # Mark task as changed only if containers were recreated
  changed_when: "'Recreating' in (_handler.stdout | default('')) or 'Creating' in (_handler.stdout | default(''))"
  failed_when: "'NO_COMPOSE' in (_handler.stdout | default(''))"

- name: Restart kafka compose
  shell: |
    if docker compose version >/dev/null 2>&1; then
      docker compose -f docker-compose.yml restart kafka
    elif docker-compose --version >/dev/null 2>&1; then
      docker-compose -f docker-compose.yml restart kafka
    else
      echo "NO_COMPOSE"
    fi
  args:
    chdir: "{{ compose_workdir }}"
  register: _handler
  changed_when: "'Restarting' in (_handler.stdout | default(''))"
  failed_when: "'NO_COMPOSE' in (_handler.stdout | default(''))"
